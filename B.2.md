## 과제명: 장애를 격리하라, 마이크로서비스 환경에서의 서킷 브레이커 설계 및 구현

### 과제 목표

* 서킷 브레이커 패턴의 동작 원리와 적용 시나리오 이해
* 장애 전파를 방지하기 위한 클라우드 네이티브 설계 실습
* 실제 환경에서 패턴을 적용해 보고, 장애 회복 시나리오 테스트

### 시나리오 설정

당신은 **온라인 영화 스트리밍 서비스**를 운영하는 개발팀의 일원입니다. 다음과 같은 마이크로서비스 구조를 가지고 있습니다:

1. **Frontend API Gateway**
2. **User Service** – 사용자 인증 및 정보 제공
3. **Recommendation Service** – 영화 추천 제공 *(외부 머신러닝 API 사용)*
4. **Catalog Service** – 영화 목록 및 상세 정보 제공

최근, **Recommendation Service**가 간헐적으로 장애를 일으켜 전체 응답 속도를 느리게 하고, 사용자 불만이 증가하고 있습니다.

### 과제 요구 사항

#### 1. 설계

* 서킷 브레이커를 어느 위치에 적용할지 설계하고 이유를 설명하시오
* 패턴의 **Closed / Open / Half-Open** 상태에 따른 처리 방안을 기술하시오
* fallback 전략을 설계하시오 (예: "추천 서비스를 잠시 사용할 수 없습니다")

#### 2. 구현

* 선택 가능한 기술:

  * 백엔드: Node.js / Python / Java 중 선택
  * 서킷 브레이커: Netflix Hystrix, Resilience4j, 또는 Polly (.NET), Istio 등
* 간단한 API 기반 시뮬레이션으로 구성하되, Recommendation Service는 의도적으로 30% 확률로 실패하도록 구현
* 서킷 브레이커를 적용하여 반복 실패 시 요청을 차단
* fallback 응답 또는 대체 콘텐츠를 반환

#### 3. 테스트

* 정상 요청 시와 장애 발생 시의 응답 속도 및 상태 비교
* 서킷 브레이커의 상태 전이 로그를 기록하고 분석
* Half-Open 상태에서의 회복 여부 테스트 (임계값 설정 실습 포함)

#### 4. 보고서 제출 항목

* 설계도 및 흐름 설명
* 코드 주요 부분 설명
* 테스트 결과 요약 (성공률, 응답 시간, 차단 횟수 등)
* 학습한 점 및 개선 아이디어

### 보너스 도전 과제

* Prometheus + Grafana를 이용하여 **서킷 브레이커 상태를 모니터링**하는 대시보드 구성
* Istio 환경에서 circuit breaker 정책을 적용하고 yaml 설정 파일 제출


## 과제 제목: 결제의 위기, 장애 전파를 막는 마지막 방패, 서킷 브레이커

### 과제 목표

* 결제 흐름에서 서킷 브레이커의 실질적 역할 이해
* 장애가 사용자 경험 및 매출에 미치는 영향 분석
* 서버리스 및 API 게이트웨이 기반 클라우드 구조에서의 서킷 브레이커 구현 실습

### 시나리오 설정

당신은 **이커머스 플랫폼**의 백엔드 개발자로 일하고 있습니다. 사용자는 장바구니에 담은 상품을 결제하기 위해 다음과 같은 절차를 거칩니다:

1. **Frontend (SPA 또는 모바일 앱)**
2. **API Gateway (e.g., AWS API Gateway or Azure API Management)**
3. **Checkout Service (Lambda / Azure Function)**
4. **Inventory Service** – 재고 확인 및 차감
5. **Payment Gateway Service** – 외부 PG사 API 호출 (불안정한 외부 시스템)

최근 외부 **Payment Gateway API**의 불안정으로 인해 Checkout 전체가 실패하거나 대기 시간이 길어지고 있습니다. 이로 인해 사용자 이탈률과 장바구니 이탈율이 증가하고 있습니다.

### 과제 요구 사항

#### 1. 문제 분석

* 장애가 어느 서비스에서 발생하며, 어떤 식으로 전체 흐름에 영향을 주는지 도식화하시오
* 서킷 브레이커를 어느 지점에 도입하면 효과적인지 판단하시오

#### 2. 서킷 브레이커 설계 및 구성

* 외부 PG API가 3회 연속 실패 시, **5분 동안 호출을 차단**하도록 설계
* 서킷이 Open일 때는 사용자에게 아래와 같은 fallback 응답 제공:
  `"현재 결제 서비스에 일시적인 오류가 발생했습니다. 나중에 다시 시도해 주세요."`
* Half-Open 상태에서 **성공률이 80% 이상일 경우 Closed 상태로 전환**

#### 3. 구현 조건

* AWS 환경 기준:

  * Lambda 또는 API Gateway + Step Functions 구조
  * 서킷 브레이커는 Lambda 내 코드 기반 (예: custom logic + DynamoDB 상태 저장)
* 또는 Azure 기준:

  * Azure Functions + Durable Functions 활용
  * 서킷 브레이커 상태는 Azure Table Storage 또는 Application Insights 기반

#### 4. 테스트 시나리오

* PG API가 30% 확률로 실패하는 조건 구현
* 사용자가 연속 결제 시도를 할 때 서킷 브레이커의 상태가 어떻게 변화하는지 로깅
* fallback 메시지를 사용자에게 정확히 전달하는지 확인

#### 5. 보고서 제출 항목

* 시스템 아키텍처 다이어그램
* 서킷 브레이커 상태 전이 시나리오 설명
* 장애 대응 효과 측정 (fallback 발생 횟수, 성공률 변화 등)
* 코드 일부 스크린샷 + 주요 로직 설명
* 회고 및 개선 방향

### 보너스 도전 과제

* 상태 저장 없이 구현하는 **Stateless 서킷 브레이커** 로직 도전
* CloudWatch 또는 Azure Monitor를 통해 **서킷 상태 시각화 대시보드 구성**
* SQS 또는 Event Grid를 활용해 **재시도 큐** 구축

