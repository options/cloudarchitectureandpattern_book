## 8.1 Observability(관찰 가능성)과 OpenTelemetry 도구

클라우드 기반 시스템은 복잡하고 동적으로 변화하는 환경에서 운영되기 때문에, 운영 중인 시스템의 상태를 정확히 파악하고 이상 징후를 조기에 탐지하는 것이 매우 중요합니다. 이러한 필요를 충족하기 위해 ‘Observability(관찰 가능성)’라는 개념이 각광받고 있으며, 이는 클라우드 네이티브 아키텍처에서 핵심적인 운영 전략으로 자리잡고 있습니다. 본 절에서는 Observability의 정의와 구성 요소, 그리고 이를 구현하기 위한 업계 표준 도구인 OpenTelemetry에 대해 폭넓고 깊이 있는 논의를 전개하도록 하겠습니다.

### Observability의 정의와 목적

Observability는 단순히 로그(log), 메트릭(metric), 트레이스(trace)를 수집하는 것을 넘어서, 시스템 내부의 상태를 외부에서 측정 가능한 지표를 통해 추론할 수 있는 능력을 의미합니다. 이는 기존의 모니터링(monitoring) 개념보다 더 진보된 접근이며, 단순히 문제를 '보는' 수준에 머무르지 않고, 어떤 문제인지 '이해할 수 있는' 준비된 시스템을 지향합니다.

Observability라는 용어는 원래 제어 이론(Control Theory)에서 유래되었으며, 시스템의 내부 상태를 관찰 가능한 출력을 통해 추론할 수 있는 성질을 뜻합니다. 이러한 맥락에서 IT 시스템의 Observability는 기본적으로 세 가지 축, 즉 로그, 메트릭, 분산 추적(distributed tracing)을 통해 구현됩니다.

> Observability는 “무엇이 잘못되었는지”를 알려주는 것이 아니라, “왜 잘못되었는지”를 스스로 유추할 수 있게 하는 시스템의 역량이라 할 수 있습니다.

### Observability의 핵심 구성 요소

Observability는 단순한 데이터 수집 체계가 아니라, 전체 시스템의 이해력을 높이기 위한 전략적인 설계 철학입니다. 다음은 일반적으로 관찰 가능성을 구성하는 세 가지 주요 기술 축입니다.

#### 로그 (Log)

로그는 사건 기반(event-based) 기록으로서, 시스템 활동에 대한 시점별 정보를 제공합니다. 로그는 일반적으로 문자열 기반이며, 사람이 읽을 수 있는 형태로 유지되기도 하지만, 머신 파싱(machine parsing)을 고려한 구조화된 로그(structured log)를 사용하는 추세가 강화되고 있습니다.

다음과 같은 요소를 고려하여 로그 시스템을 설계하시는 것이 좋습니다.

- 로그 레벨(Level): DEBUG, INFO, WARN, ERROR, FATAL 등의 분류를 정의합니다.
- 구조화된 로그: JSON, XML 등의 형태로 필드를 나누어 머신이 쉽게 파싱할 수 있도록 합니다.
- 컨텍스트 정보: 로그에 트랜잭션 ID, 유저 ID, 서비스 이름 등의 메타 정보를 포함시켜 추적을 용이하게 합니다.

로그는 문제가 발생했을 때 상세한 스택 트레이스나 예외 메시지를 제공하며, 디버깅 및 포렌식(원인 분석)에 활용되는 핵심 도구입니다.

#### 메트릭 (Metric)

메트릭은 수치 기반의 데이터로, 시간에 따른 시스템 상태의 추세를 보여줍니다. 예를 들어 CPU 사용률, 평균 응답 시간, HTTP 요청 수, 에러율 등이 대표적인 메트릭입니다. 메트릭은 일반적으로 시계열(Time Series) 데이터 형태로 저장되며, 경량화된 데이터라서 실시간 경고 및 대시보드 시각화에 적합합니다.

메트릭 시스템 설계 시 고려할 점은 다음과 같습니다.

- 수집 주기(Resolution): 너무 짧으면 비용이 증가하고, 너무 길면 민첩성 저하
- 태그 기반 메타데이터 시스템: 서비스, 지역, 인스턴스 ID 등을 태그로 추가 가능
- Aggregation: 평균, 분산, Percentile(대부분 p95, p99), 카운트 등의 집계 함수 활용
- 알람 조건 정의: 스레숄드 기반 또는 이상 탐지 기반 자동 알림 구성

메트릭은 SLA(SLO/SLI) 준수 여부를 판단하거나 시스템 리소스의 병목을 조기에 파악하는 데에 큰 역할을 합니다.

#### 분산 추적 (Distributed Tracing)

분산 추적은 하나의 요청이 여러 마이크로서비스를 거쳐 최종적인 응답을 완료할 때까지 전체 흐름을 추적하는 기법입니다. 이는 특히 마이크로서비스 기반 아키텍처에서 중요하며, 병목, 느림(latency), 실패 항목을 정확히 식별할 수 있도록 해줍니다.

다음은 대표적인 분산 추적 구현 방식입니다.

- Trace ID를 요청 헤더 혹은 컨텍스트에 포함시켜 전체 호출 체인을 추적
- Span: 호출 간 단위 작업(Operation)을 의미, Span 간 계층 구조(Parent-Child 관계)를 통해 호출 트리 형성
- 자동 또는 수동 트레이싱 방식: 애플리케이션 프레임워크에서 자동으로 Span 정보를 수집하거나, 개발자가 코드 상에 직접 삽입하는 방식

분산 추적을 통해 API 응답 지연의 원인을 특정 마이크로서비스, 혹은 외부 의존 항목으로 좁힐 수 있어 성능 최적화나 회복 전략 수립에 기여합니다.

### OpenTelemetry로 구현하는 통합 관찰 가능성 플랫폼

OpenTelemetry는 로그, 메트릭, 트레이스를 위한 수집(agent), 처리(processor), 내보내기(exporter) 기능을 표준화한 공개 프로젝트로, CNCF(Cloud Native Computing Foundation)의 주도 하에 개발되고 있습니다. 이는 이전의 OpenTracing 및 OpenCensus 프로젝트를 통합한 결과물입니다.

OpenTelemetry를 활용하면 Observability 데이터를 수집하는 방식과 도구들을 통일된 방식으로 정리할 수 있으며, 벤더 중립적인 관찰 플랫폼을 구축할 수 있습니다.

#### OpenTelemetry의 주요 구성 요소

OpenTelemetry는 다음과 같은 계층별 아키텍처로 구성되어 있습니다.

- SDK (Instrumentation Layer): 애플리케이션 코드에 직접 또는 간접적으로 삽입되어, Span, Metric, Log 데이터를 수집합니다.
- Collector: 데이터 수집, 처리, 내보내기 파이프라인을 구성하는 독립 실행형 컴포넌트입니다. 다양한 수신자(receiver), 프로세서(processor), 수출자(exporter)를 조합하여 확장 가능합니다.
- Exporter: 수집된 데이터를 외부 저장소(예: Prometheus, Grafana, Jaeger, Zipkin, Datadog, New Relic 등)로 전송하는 모듈입니다.

#### 실제 적용 예시

마이크로서비스로 구성된 웹 애플리케이션에서 OpenTelemetry를 기반으로 Observability를 구축한 사례를 살펴보겠습니다.

1. 서비스-A, 서비스-B, 서비스-C 전체에 OpenTelemetry SDK를 통해 Trace ID와 Span을 주입
2. 로그는 JSON 구조로 stdout에 출력되고, OpenTelemetry 로그 수집기가 이를 수집
3. 메트릭은 Prometheus exporter를 통해 주기적으로 내보내지며, Grafana에서 대시보드로 시각화
4. Trace 정보는 OpenTelemetry Collector를 통해 Jaeger로 전달되며, 전체 호출 트리 확인 가능
5. OpenTelemetry Collector를 중앙에서 관리하여, 독립적인 설정 변경, 라우팅, 데이터 필터링이 가능하게 구성

이와 같은 설계를 통해 운영자는 단일 장애 지점을 빠르게 파악하고, 각 서비스의 성능 병목, 에러율, 영향을 받은 사용자 영역 등을 통합적으로 분석할 수 있습니다.

### Observability 구축 시 고려할 전략적 포인트

Observability는 단순히 도구를 설치하는 것만으로 달성되지 않습니다. 다음과 같은 전략이 함께 수립되어야 진정한 관찰 가능성이 확보됩니다.

- 표준화된 데이터 수집 정책 수립: 로그 및 메트릭 필드의 명명 규칙, Trace ID 부여 방식의 통일
- Context Propagation 문제 해결: Cross-service 간 Trace ID 전파가 누락되지 않도록 철저한 전파 체계 구성
- 샘플링(Sampling) 전략 수립: 모든 트레이스를 수집하는 것은 비용이 높으므로 확률적 또는 동적 샘플링 적용
- DevOps와 협업 체계 마련: 관찰 가능성 기반의 문제 해결을 위해 개발–운영 간 원활한 커뮤니케이션 수단 확보
- AIOps 및 이상 징후 탐지를 위한 ML 도입 검토: 대규모 로그 및 메트릭을 ML로 분석하여 자동화된 경고 및 대응 가능

### 마무리하며

Observability는 현대 소프트웨어 인프라에서 더 이상 선택이 아닌 필수 요소입니다. 특히 마이크로서비스와 분산 아키텍처가 증가하면서, 로그, 메트릭, 트레이스의 통합적 확보 없이는 문제의 근본 원인을 추적하는 것이 거의 불가능에 가깝습니다. OpenTelemetry는 이러한 관찰 가능성 구축을 위한 강력한 프레임워크이며, 다양한 클라우드 환경에서도 벤더 종속 없이 유연하게 도입할 수 있는 장점을 지닙니다.

개발자와 아키텍트께서 이 장에서 설명드린 내용을 기반으로, 자신의 서비스에 필요한 관찰 가능성 체계 구축을 계획하고 설계 전략을 정립하신다면, 복잡한 클라우드 환경에서도 안정성과 가시성을 갖춘 운영 체계를 구성하실 수 있을 것입니다.