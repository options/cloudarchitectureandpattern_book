## 4.4 API 게이트웨이(API Gateway) 패턴

현대의 클라우드 애플리케이션은 대체로 다수의 마이크로서비스로 구성되어 있으며, 각 서비스는 자신의 도메인 책임에 따라 독립적인 기능을 제공합니다. 이러한 구성은 유연성과 확장성, 빠른 배포 등 여러 이점을 제공하지만, 동시에 일부 복잡성을 유발하기도 합니다. 특히 클라이언트와 서비스 간의 통신 경로가 분산되면서, 트래픽 라우팅, 인증, 속도 제한, 응답 집계 등 다양한 교차 관심사(Cross-Cutting Concerns)를 효율적으로 처리해야 하는 과제가 발생합니다.

이러한 배경에서 등장한 것이 API 게이트웨이(API Gateway) 패턴입니다. 이 절에서는 API 게이트웨이 패턴의 정의와 역할, 아키텍처 상의 위치, 주요 기능, 대표 구현체, 패턴 적용 시 유의할 점 등을 체계적으로 다루고자 합니다.

### API 게이트웨이 패턴의 정의

API 게이트웨이 패턴이란, 클라이언트 요청을 받아 적절한 백엔드 마이크로서비스로 프록시하거나 라우팅해주는 단일 접점(Entry Point)을 두는 아키텍처 스타일을 말합니다. API 게이트웨이는 클라이언트 요청이 시스템에 진입하는 관문이자, 다양한 기능을 담당하는 중계 계층(Middle Layer)으로서 동작합니다.

이 패턴은 사용자 경험을 향상시키고, 클라이언트 애플리케이션에서의 복잡한 마이크로서비스 구조에 대한 노출을 최소화합니다. 클라이언트는 다수의 서비스와 직접 통신할 필요 없이, 단일한 API를 통해 모든 기능에 접근할 수 있으며, 백엔드 서비스의 변경은 API 게이트웨이 내부의 라우팅 규칙만 수정함으로써 은닉될 수 있습니다.

### API 게이트웨이의 주요 기능들

API 게이트웨이는 단순한 리버스 프록시(reverse proxy)를 넘어서, 여러 가지 기능을 함께 수행합니다. 주요 기능은 다음과 같습니다.

1. 트래픽 라우팅 (Routing)

   API 게이트웨이는 요청 URL, HTTP 메소드, 헤더 등 다양한 정보를 바탕으로 적절한 백엔드 서비스로 요청을 라우팅합니다. 예를 들어 `/users/123` 요청은 사용자 서비스로, `/orders/456` 요청은 주문 서비스로 전달됩니다.

2. 인증 및 권한 부여 (Authentication & Authorization)

   클라이언트 요청이 내부 서비스에 도달하기 전에 사용자 인증이나 권한 검사가 필요할 경우, API 게이트웨이에서 이를 미리 수행할 수 있습니다. OAuth2, JWT 기반 토큰 검증 등이 대표적인 사례이며, 이로 인해 각 개별 마이크로서비스에서 중복 구현을 방지할 수 있습니다.

3. 요청 병합 및 응답 집계 (Request Aggregation)

   하나의 클라이언트 요청이 여러 마이크로서비스의 응답을 필요로 할 경우, API 게이트웨이에서 이를 대신 병합 처리할 수 있습니다. 예를 들어, 쇼핑몰의 상품 상세 페이지에 대해 상품 정보, 재고 현황, 리뷰 목록 등을 병행 호출하여 하나의 JSON 응답으로 집계하는 식입니다.

4. 속도 제한 및 할당량 관리 (Rate Limiting & Quotas)

   서비스 보호를 위해 API 게이트웨이는 사용자의 요청 빈도를 제어할 수 있습니다. 사용자당 초당 요청 수 제한, IP 차단 리스트, 사용자 요금제별 API 사용량 제한 등이 이에 해당합니다.

5. 로깅 및 분석 (Logging & Monitoring)

   각 요청에 대한 정보(요청 URI, 응답 코드, 처리 시간 등)를 수집하여 중앙 집중식 모니터링 시스템으로 전달할 수 있습니다. 이를 통해 SLA 준수 여부를 측정하거나 이상 징후를 조기에 탐지할 수 있습니다.

6. 캐싱 (Response Caching)

   자주 조회되는 데이터에 대해 응답을 캐싱함으로써, 마이크로서비스의 부하를 줄이고 응답 속도를 향상시킬 수 있습니다. API 게이트웨이는 내부 또는 외부 캐시 시스템(Redis 등)과 연동하여 이를 수행할 수 있습니다.

7. 요청/응답 변환 (Transformation)

   요청의 페이로드나 응답 포맷을 변환하는 기능을 제공함으로써, API 버전 호환성 또는 클라이언트 요구사항에 맞춘 커스터마이징을 지원합니다. 예를 들어 V1 API의 JSON 구조를 백엔드 서비스의 새로운 구조에 맞게 변환할 수 있습니다.

8. 보안 정책 적용 (Security Enforcement)

   웹 애플리케이션 방화벽(WAF), HTTPS 강제화, CORS 관리 등 API 수준에서의 통합 보안 정책을 수립하고 적용하는 데 API 게이트웨이가 중요하게 작용합니다.

### API 게이트웨이의 아키텍처상 위치

API 게이트웨이는 일반적으로 내부 서비스와 외부 클라이언트 사이에 위치합니다. 특히 마이크로서비스 아키텍처에서는 아래와 같은 아키텍처 패턴으로 자주 구현됩니다.

```
[Client] -> [API Gateway] -> [Microservice Group]
```

- 클라이언트는 직접적으로 마이크로서비스들과 통신하지 않고 모든 요청을 API 게이트웨이를 경유하도록 설계됩니다.
- 게이트웨이는 요청을 적절한 엔드포인트로 라우팅하거나, 필요 시 응답을 집계하여 반환합니다.
- 백엔드 서비스들은 API 게이트웨이 뒤에 위치하여 외부에 직접 노출되지 않고 보안 측면에서도 더 안전하게 구성됩니다.

또한 기업 환경에서는 내부 사용자(사내 시스템) 트래픽과 외부 사용자(웹/앱 기반)의 트래픽을 분리하여, 서로 다른 API 게이트웨이를 두는 전략도 종종 사용됩니다.

### 대표적인 API 게이트웨이 구현체

API 게이트웨이는 상용 또는 오픈 소스 소프트웨어로 구현되며, 그 중 대표적인 예시는 다음과 같습니다.

- Amazon API Gateway: AWS의 완전관리형 서비스로, REST 및 WebSocket API 지원, 인증 통합, 캐싱, 로깅 등을 제공합니다.
- Kong: 오픈 소스이자 플러그인 기반 API 게이트웨이 솔루션으로, 고성능 NGINX 기반으로 구축되어 있으며 확장성과 커스터마이징에서 강점을 가집니다.
- Spring Cloud Gateway: 주로 JVM 기반 마이크로서비스에서 사용되는 게이트웨이로, 스프링 생태계의 연계가 자연스럽고 라우팅, 필터링, 인증 등 공통 기능이 내장되어 있습니다.
- Apigee: Google Cloud에서 제공하는 엔터프라이즈 등급 API 관리 플랫폼으로, 고급 트래픽 정책, 사용자 분석, 모니터링 기능을 포함합니다.
- NGINX + Lua 혹은 NGINX+ 등의 조합도 고성능 프록시 서버 기반의 API 게이트웨이 용도로 자주 활용됩니다.

각 게이트웨이 구현체는 기능, 성능, 확장성, 분석 도구 호환성 등의 측면에서 선택 기준이 상이하므로, 사용하려는 서비스 규모와 아키텍처 전략에 따라 적절한 선택이 요구됩니다.

### API 게이트웨이 패턴 적용 시 유의사항

API 게이트웨이를 도입하고 운영함에 있어 고려해야 할 사항도 존재합니다.

1. 단일 장애 지점(Single Point of Failure)

   모든 요청이 API 게이트웨이를 거쳐 처리되기 때문에, 해당 구성 요소의 가용성이 전체 시스템의 안정성과 직결됩니다. 따라서 게이트웨이 인스턴스 이중화, 리전 또는 영역 간 분산 배치, 로드 밸런싱 등의 전략이 필요합니다.

2. 복잡성 증가 및 관리 부담

   다양한 기능을 API 게이트웨이에 집중시킬 경우, 오히려 게이트웨이 자체의 구성이 복잡해지고 유지보수 포인트가 증가할 수 있습니다. 경우에 따라서는 일부 기능(예: 인증, 로깅, 캐싱 등)을 별도의 서비스로 분리하는 것도 고려해야 합니다.

3. 과도한 응답 지연

   다수의 마이크로서비스 응답을 집계하는 경우, 종단 간 응답 시간이 늘어날 수 있습니다. 특히 서비스 중 하나의 성능 저하나 타임아웃이 전체 응답에 영향을 줄 수 있으므로, 응답 병합은 신중하게 적용되어야 합니다. 이를 보완하기 위한 서킷 브레이커, 타임아웃 관리 등의 패턴과 결합이 필요합니다.

4. API 버저닝과 호환성 유지

   API 게이트웨이에서 다양한 클라이언트(웹/모바일/iOT 등)가 접근하는 환경에서는 API 버전 관리 전략과 하위 호환성 정책이 중요해집니다. 명시적 버전 라우팅(예: /v1/, /v2/) 및 API Deprecation 전략을 수립해야 합니다.

### 실제 적용 사례: 이커머스 플랫폼에서의 API 게이트웨이

한 글로벌 이커머스 기업은 기존 모놀리식 시스템을 마이크로서비스로 분해하면서, API 게이트웨이를 도입하였습니다. 사용자는 모바일 앱을 통해 상품 검색, 장바구니, 결제 등 다양한 기능을 수행하게 되며, 각각의 기능은 서로 독립된 서비스입니다.

API 게이트웨이는 사용자의 모든 요청을 수신하여 기반 서비스로 라우팅했으며, 인증은 OAuth2 기반 토큰으로 검증하였습니다. 인기 제품 리스트 등 고빈도 요청 데이터는 캐싱을 적용하여 평균 응답 시간을 약 30% 단축하였고, 서비스 간 응답 병합을 통해 클라이언트 애플리케이션의 API 호출 수를 약 50% 줄이는 데 성공했습니다.

API 요청에 대한 상세 로깅, 모니터링 지표를 통해 서비스 별 SLA 관리가 가능해졌으며, 버전 관리 정책을 통해 기존 사용자와 새로운 사용자 모두에게 동일한 사용자 경험을 제공할 수 있었습니다.

### 요약하며

API 게이트웨이 패턴은 마이크로서비스 아키텍처에서 폐쇄적이며 통제된 API 관리 지점을 마련하기 위한 핵심 아키텍처 구성 요소입니다. 다양한 교차 관심사(Cross-Cutting Concern)를 API 수준에서 처리함으로써, 개별 서비스의 복잡성을 줄이고, 클라이언트 개발의 생산성과 효율성을 함께 높일 수 있습니다. 그러나 단일 장애 지점, 성능 병목, 과도한 역할 집중 등에 대한 고려 없이 사용될 경우 시스템의 안정성에 악영향을 줄 수 있으므로, 올바른 기대 수준과 아키텍처 설계 원칙에 따른 도입이 중요합니다.