## 6.4 데이터 파티셔닝(Partitioning)과 샤딩(Sharding) 전략

현대의 클라우드 환경에서 데이터를 효율적으로 저장·관리하기 위해서는 확장성과 성능을 고려한 저장소 아키텍처 설계가 필수적입니다. 특히 데이터 양이 기하급수적으로 증가함에 따라, 단일 노드 또는 제한된 리소스를 기반으로 한 저장 방식은 곧 병목이나 시스템 불안정성의 원인이 되곤 합니다. 이러한 문제를 해결하기 위한 대표적인 설계 기술로 데이터 파티셔닝(Partitioning)과 샤딩(Sharding)이 존재합니다. 이 절에서는 두 개념의 정의 및 차이점, 설계 전략, 유형, 적용 시 고려사항, 그리고 실제 사례를 중심으로 깊이 있는 설명을 드리겠습니다.

### 데이터 파티셔닝과 샤딩의 정의와 차이점

파티셔닝(partitioning)은 전체 데이터를 여러 개의 분할된 조각으로 나누는 기술입니다. 각 파티션은 논리적 또는 물리적인 단위로 존재할 수 있으며, 이들 각각은 독립적인 저장 및 처리 단위가 됩니다. 반면 샤딩(sharding)은 이러한 파티셔닝을 한층 더 진화시킨 개념으로, 주로 분산 환경에서 스케일 아웃(scale-out)을 통해 데이터를 수평적으로 분산하는 작업을 의미합니다. 즉, 샤딩은 여러 서버(또는 노드)로 데이터를 나눠 저장함으로써, 대규모 처리 성능과 고가용성을 확보하는 기법입니다.

간단히 요약하면, 파티셔닝은 일반적으로 논리적 데이터 분할을 포괄하는 상위 개념이며, 샤딩은 해당 파티션을 서로 다른 물리적 노드에 분산 배치하여 확장성과 독립성을 극대화한다는 점에서 실질적인 구현기술에 가깝습니다.

- 파티셔닝: 논리적인 데이터 분할
- 샤딩: 파티션을 물리적인 노드에 분산 배치

그러므로 모든 샤딩은 파티셔닝의 일종이지만, 모든 파티셔닝이 샤딩인 것은 아닙니다.

### 파티셔닝 및 샤딩의 주요 목적

1. 수평적 확장(Horizontal Scalability):  
   중앙 집중적인 데이터 저장소 대신 데이터를 여러 노드에 분산함으로써 시스템 용량을 확장합니다.

2. 성능 향상(Performance):  
   읽기 및 쓰기 요청을 개별 샤드에 분산 처리함으로써 처리 속도를 향상시킵니다.

3. 고가용성(High Availability):  
   특정 샤드에 장애가 발생하더라도 전체 시스템이 완전히 중단되지 않도록 설계할 수 있습니다.

4. 유지 보수 용이성:  
   전체 데이터를 마이그레이션하거나 유지 보수하는 부담을 줄이고, 부분적인 데이터 집합만 대상으로 작업이 가능합니다.

### 파티셔닝/샤딩 전략의 유형들

데이터를 어떻게 나눌 것인가는 전체 시스템의 성능과 운영 효율성에 중대한 영향을 미칩니다. 일반적으로 사용되는 주요 파티셔닝/샤딩 전략은 다음과 같습니다.

#### 1. 범위 기반 파티셔닝 (Range-based Partitioning)

데이터의 특정 값(예: 날짜, 사용자 ID 등)에 따라 구간을 정의하여 나누는 방식입니다.

- 예시: 1~1000번 사용자 데이터는 샤드 A에, 1001~2000번은 샤드 B에 저장.
- 장점: 쿼리가 특정 범위에 집중될 경우 성능이 매우 우수함.
- 단점: 일부 구간에 로드가 집중되는 hotspot(열점) 문제 발생 가능.

#### 2. 해시 기반 파티셔닝 (Hash-based Partitioning)

데이터의 기준 컬럼(샤드 키)을 해싱하여 결과에 따라 샤드를 결정합니다. 예를 들어 `user_id % 4`의 값에 따라 0, 1, 2, 3번 샤드에 분배합니다.

- 장점: 데이터가 균등하게 분포되고 로드 밸런싱에 유리함.
- 단점: 쿼리가 전체 샤드를 조회해야 할 경우 비효율적이며, 샤드 수가 변경되면 재배치가 불가피함.

#### 3. 리스트 기반 파티셔닝 (List-based Partitioning)

사전에 정의된 범주형 값의 목록을 기준으로 파티션을 지정합니다.

- 예시: 국가별 파티션 (한국은 샤드 A, 미국은 샤드 B 등)
- 장점: 명확한 기준으로 관리자 입장에서 직관적으로 제어 가능함.
- 단점: 새로운 범주를 추가하거나 분포를 재설정할 때 재작업 필요.

#### 4. 복합 키 기반 파티셔닝 (Composite or Hybrid Partitioning)

다수의 기준을 함께 사용하는 방식입니다. 예를 들어 국가별로 먼저 파티셔닝한 후 그 안에서 해시 기반으로 셰어링하는 등의 복합 전략이 가능합니다.

- 장점: 부하 분산과 특정 쿼리 성능을 동시에 고려할 수 있음.
- 단점: 구현 복잡성이 높고 유지 보수 및 모니터링에 많은 리소스 필요.

### 샤딩 키(Sharding Key)의 선택 기준과 고려사항

샤딩 키는 해당 레코드를 어느 샤드에 저장할지를 결정하는 기준 값입니다. 적절한 샤딩 키의 설계는 전체 샤딩 전략의 성패를 좌우합니다. 다음 요소들을 고려해야 합니다.

- 데이터 접근 패턴: 샤딩 키는 자주 변화하지 않으며, 자주 조회되는 필드여야 성능 면에서 유리합니다.
- 쿼리 종류: 조인이나 범위 조회 등 많은 쿼리에서 샤딩 키가 조건절에 포함되어야 합니다.
- 데이터의 분산 정도: 키의 값이 고르게 분포되어야 특정 샤드에 부하가 집중되지 않습니다.
- 샤드 갯수의 변경 가능성: 향후 확장 시에도 기존 키와 구조를 안정적으로 유지할 수 있어야 합니다.

### 샤딩 후 동기화, 재샤딩 등 운영 복잡성

1. 크로스 샤드 조인:  
   샤드 간 조인이 발생할 경우 성능 저하 및 복잡한 실행 계획이 필요해질 수 있습니다. 이를 해결하기 위해 Denormalization이나 애플리케이션 레벨 조인 등이 사용됩니다.

2. 샤드 갯수 변경(Scaling Out / Re-sharding):  
   기존 샤드를 재조정하려면 레코드를 다른 샤드로 이동해야 하며, 이는 복잡성과 다운타임의 원인이 될 수 있습니다. 일부 시스템은 리밸런싱 기능이 내장되어 있으나, 일반적으로 고난도의 마이그레이션 전략이 병행되어야 합니다.

3. 트랜잭션 일관성(Transactional Consistency):  
   다수의 샤드를 걸치는 트랜잭션은 ACID 보장이 어렵습니다. 이 경우 SAGA 또는 2-phase commit 등 분산 트랜잭션 기법이 필요합니다.

4. 모니터링 및 장애 처리:  
   각 샤드별 상태를 독립적으로 감시해야 하며, 장애 발생 시 빠르게 다른 노드로 페일오버할 수 있는 메커니즘이 필요합니다.

### 샤딩을 지원하는 프레임워크 및 솔루션

다양한 오픈소스 및 상용 솔루션은 샤딩 기능을 기본으로 제공합니다. 그 중 일부는 다음과 같습니다.

- MongoDB: 기본적으로 해시 기반 및 범위 기반 샤딩을 지원하며 샤드 클러스터 형태로 운영됩니다.
- Apache Cassandra: 고유한 토큰 기반 파티셔닝 방식으로 자동 샤딩 및 리밸런싱 기능을 제공합니다.
- Vitess: MySQL의 샤딩과 스케일링을 돕는 오픈소스 솔루션으로, 대규모 트래픽 처리에 특화되어 있습니다.
- Amazon Aurora: 서버리스 모드나 리플리케이션 기반으로 파티셔닝된 형태의 데이터 접근 최적화를 제공합니다.
- CockroachDB: 강력한 분산 SQL 기능과 자동 샤딩을 내장한 뉴SQL 엔진입니다.

### 실제 적용 사례로 살펴보는 샤딩 전략

1. Twitter:  
   초기에는 단일 PostgreSQL 인스턴스에 사용자 데이터를 저장했으나, 빠르게 증가한 사용자 수로 인해 데이터 분산이 필수가 되었습니다. 이후 사용자 ID를 기준으로 수십 개의 샤드에 데이터를 분산 저장하도록 시스템을 구성했습니다.

2. Shopify:  
   다수의 고객(상점)을 처리하기 위해 특정 상점별로 데이터를 독립적인 샤드에 저장하여 격리성과 고가용성을 확보했습니다. 상점 ID가 곧 샤딩 키의 역할을 수행했습니다.

3. LINE:  
   메시지 데이터를 국가 및 사용자 범위 기반으로 샤딩하여 로컬 읽기/쓰기 성능을 향상시키는 동시에 데이터 주권과 규제에 대응할 수 있도록 구현했습니다.

### 마무리하며

데이터 파티셔닝과 샤딩 전략은 클라우드 환경에서 대용량 데이터를 안정적이고 확장 가능하게 운영하기 위한 핵심 도구입니다. 설계 시에는 단순히 데이터 분산만 고려해서는 안 되며, 접근 패턴, 샤딩 키 선택, 장애 처리 정책, 운영 복잡성까지 종합 분석하여야 합니다. 장기적인 시스템 유연성과 유지 보수 가능성을 확보하기 위해서는 초기 단계부터 이들 전략을 충분히 검토하고 적용하는 것이 바람직합니다. 데이터 아키텍트 및 개발자는 이 절에서 제시한 다양한 전략과 사례를 바탕으로 자사의 서비스 요구사항에 최적화된 분산 데이터 구조를 설계하실 수 있으시길 바랍니다.