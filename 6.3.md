## 6.3 폴리글랏 퍼시스턴스(Polyglot Persistence) 패턴

현대의 클라우드 기반 애플리케이션은 하나의 데이터 저장 방식만으로는 다양한 요구사항을 충족하기 어렵습니다. 사용자 경험, 대량 트래픽 처리, 데이터 일관성, 트랜잭션 안전성, 비정형 데이터 저장 등 서로 이질적인 요구 조건에 대응하기 위해서는 유연하고 복합적인 데이터 저장 전략이 필수적입니다. 이러한 맥락에서 자연스레 등장한 개념이 폴리글랏 퍼시스턴스(Polyglot Persistence)입니다.

이 절에서는 폴리글랏 퍼시스턴스의 정의와 필요 배경, 구성 전략, 기술 선택 시의 고려사항, 그리고 실제 적용 사례를 중심으로 이 패턴을 해부하고자 합니다.

### 폴리글랏 퍼시스턴스란 무엇인가

폴리글랏 퍼시스턴스란 여러 종류의 데이터 저장 기술(예: 관계형 데이터베이스, 문서 지향 데이터베이스, 그래프 데이터베이스 등)을 하나의 시스템 또는 애플리케이션 내에서 병렬적으로 사용하는 아키텍처 패턴을 의미합니다.

'폴리글랏(Polyglot)'이라는 용어는 본래 여러 프로그래밍 언어를 동시에 활용하는 개발 스타일에서 비롯되었으며, 여기서는 '여러 데이터 저장 기술 간의 공존'이라는 의미로 확장하여 사용됩니다.

핵심적인 전제는 모든 종류의 데이터나 요구사항을 하나의 데이터베이스 유형으로 해결하기는 어렵다는 데 있으며, 따라서 데이터의 성격과 액세스 패턴에 따라 최적화된 저장소를 선택함으로써 시스템의 품질과 성능을 극대화할 수 있습니다.

### 폴리글랏 퍼시스턴스를 채택하는 배경과 요구사항

기존의 일원화된 RDBMS 기반 설계 방식은 다양한 애플리케이션의 수직 확장이나 도메인 특화 요구사항을 수용하는 데 한계가 있었습니다. 아래와 같은 상황에서는 복수 형태의 데이터 저장소 조합이 더 합리적일 수 있습니다:

- 다양한 데이터 형태의 저장: JSON, 이미지, 로그, 텍스트 등 구조화/비구조화 데이터를 모두 다루어야 하는 경우
- 성능 차별화: 사용자 프로필은 고트랜잭션 일관성(RDB), 검색은 빠른 인덱싱(NoSQL - 예: Elasticsearch), 사용자 이벤트는 가볍고 빠른 쓰기 지향 저장소(Time-series 또는 Kafka)로 분리
- 도메인 분산 아키텍처(Microservices): 각 도메인마다 요구되는 트랜잭션 특성과 쿼리 형태가 달라, 저장소 기술이 달라지는 경우
- GDPR 또는 규제 컴플라이언스 준수: 특정 저장소는 마스킹/키 관리 기능이 중요할 때 별도 기술로 분리

이러한 배경에서 폴리글랏 퍼시스턴스는 일종의 전략적 아키텍처 결정이며, 단순한 기술 혼합이 아닌, 시스템 설계의 철학적 전환을 반영한다고 볼 수 있습니다.

### 구성 전략 및 구현 방식

폴리글랏 퍼시스턴스를 성공적으로 구현하기 위해서는 다음과 같은 구성 전략이 필요합니다.

#### 1. 도메인 중심 저장소 분리

마이크로서비스 아키텍처와의 궁합이 가장 좋은 방식입니다. 각 도메인이 고유의 요구사항에 맞는 DBMS를 선택하고 독립적으로 관리합니다. 예를 들어,

- 주문 서비스: 관계형 DB (PostgreSQL)
- 상품 서비스: 문서 지향 DB (MongoDB)
- 검색 서비스: 전문 검색 엔진 (Elasticsearch)
- 사용자 이벤트 로그: 로그 기반 저장소 (Kafka, Amazon Kinesis)

#### 2. 데이터 저장 방식 분리

하나의 서비스 내에서 데이터를 용도에 따라 서로 다른 저장소에 나누어 저장하는 방식입니다.

- 실시간 조회: Redis 같은 인메모리 캐시
- 장기 보관: Amazon S3와 같은 오브젝트 스토리지
- 동기 트랜잭션: 관계형 데이터베이스
- 비동기 이벤트: 이벤트 스트리밍 저장소

이 방식은 서비스 내 복합적인 요구사항에 대응할 수 있으나, 일관성과 중복 처리를 위한 아키텍처 통제가 필요합니다.

#### 3. API/데이터 액세스 계층 추상화

다양한 스토리지를 사용하는 시스템에서는 액세스 계층의 추상화가 핵심적인 역할을 담당합니다. 데이터 액세스 인터페이스는 저장소와 무관하게 표준화되어 있으며, 내부 구현만 저장소에 맞춰 교체 가능한 구조(Clean Architecture 또는 Hexagonal Architecture)가 권장됩니다.

추상화된 Repository Layer 혹은 Query Service들은 다음과 같이 저장소에 따라 분기될 수 있습니다:

- RDB용 JPA 리포지터리
- MongoDB용 Spring Data Mongo 리포지터리
- 검색 인덱스용 Elasticsearch 쿼리 서비스

이러한 계층적 분리를 통해 코드 변경 없이 저장소 전환이나 추가가 가능해줍니다.

#### 4. 데이터 동기화와 일관성 전략

다양한 저장소를 사용할 경우, 데이터가 여러 저장소에 중복 저장되는 경우가 많습니다. 예를 들어, MongoDB에서 상품 정보를 조회하고, Elasticsearch로 인덱싱된 동일한 정보를 검색할 수 있어야 할 수도 있습니다.

이런 설계에서는 다음 사항이 중요합니다:

- 변경 전파: Change Data Capture(CDC) 또는 이벤트 기반 비동기 동기화
- 최종 일관성 보장: eventual consistency 패턴 사용
- 트랜잭션 일관성 전략: Saga, 2PC, Outbox 패턴 등 복합 트랜잭션 처리

### 도입 시 고려사항 및 도전 과제

폴리글랏 퍼시스턴스를 도입할 때에는 유연성과 성능 이점 외에도 다음과 같은 핵심 고려사항이 존재합니다.

- 운영 복잡도 증가: 다양한 저장소를 운용하기 위한 배포 전략, 스케일링, 백업/복구 정책 등 관리 비용이 증가합니다.
- 팀 역량 분산: 각 저장소에 대한 전문 지식이 필요하며, 도메인별로 담당 엔지니어가 분화되어야 합니다.
- 데이터 통합 분석의 어려움: 공통 저장소가 없기 때문에 일괄 분석(Hadoop, Spark 등)을 위해서는 ETL 파이프라인 혹은 통합 저장소가 필요합니다.
- 장애 복합성 증가: 단일 장애가 아닌, 복합 장애나 저장소 간 동기화 실패에 대한 시나리오 설계가 요구됩니다.

따라서, 아키텍트는 단지 성능이나 유행만을 고려해 이 패턴을 채택해서는 안 되며, 전체 시스템의 복잡성과 장기적인 유지 보수 전략을 함께 고려해야 합니다.

### 실제 적용 사례

폴리글랏 퍼시스턴스를 성공적으로 적용한 대표적인 사례는 여러 글로벌 기업에서 찾아볼 수 있습니다.

#### LinkedIn

- 사용자 관계: 그래프 데이터베이스 (Voldemort → Espresso)
- 피드/타임라인: 문서/키-값 저장소 (Kafka, RocksDB 기반 시스템)
- 검색 기능: Elasticsearch 기반의 분산 인덱싱 시스템

LinkedIn은 도메인에 따라 최적 구성을 선택하고 있으며, 사내 엔진인 Rest.li 프레임워크를 통해 이를 통합 관리합니다.

#### Netflix

- 사용자 환경: Cassandra (대용량 사용자 세션)
- 영화 메타데이터: MySQL + Elasticsearch
- 이벤트/트래픽 로깅: Kafka + Amazon S3
- 추천 엔진: Druid + Spark 기반 분석 파이프라인

Netflix는 각 데이터 시스템에 대한 표준화된 API 통합 계층을 구성하고 있어, 개발자 혼란을 최소화하면서 시스템의 스케일과 다양성을 유지하고 있습니다.

### 결론적으로

폴리글랏 퍼시스턴스는 복합적인 비즈니스 요구사항과 도메인 특화 저장 전략을 조화롭게 결합할 수 있는 강력한 패턴입니다. 그러나 그만큼 아키텍처 구성, 장애 대응, 데이터 통합 등 다양한 측면에서 시스템 전체에 깊은 영향을 미치게 됩니다.

이 패턴을 채택하기 전, 문제를 해결하는 데 추가적인 저장소 도입이 필수적인지 깊이 고민해보는 것이 필요하며, 이를 위해 POC(사전 검증 절차)나 시뮬레이션을 수행해보는 것도 좋은 접근입니다.

마지막으로, 폴리글랏 퍼시스턴스는 고립된 기술 전략이 아니라, 전체 클라우드 아키텍처 내에서의 도메인 전략, 운영 전략, 비용 통제 전략과 긴밀히 연결된 의사 결정이 되어야 바람직합니다.